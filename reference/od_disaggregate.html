<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Split-up each OD pair into multiple OD pairs based on subpoints/subzones — od_disaggregate • od</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Split-up each OD pair into multiple OD pairs based on subpoints/subzones — od_disaggregate"><meta property="og:description" content="This function is for splitting-up OD pairs.
It increases the number of rows in an OD dataset, while aiming
to keep the amount of travel represented in the data the same.
To take an analogy from another package, it's roughly equivalent
to tidyr::pivot_longer()."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">od</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/od.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/itsleeds/od/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Split-up each OD pair into multiple OD pairs based on subpoints/subzones</h1>
    <small class="dont-index">Source: <a href="https://github.com/itsleeds/od/blob/main/R/aggregate.R" class="external-link"><code>R/aggregate.R</code></a></small>
    <div class="hidden name"><code>od_disaggregate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is for splitting-up OD pairs.
It increases the number of rows in an OD dataset, while aiming
to keep the amount of travel represented in the data the same.
To take an analogy from another package, it's roughly equivalent
to <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link"><code>tidyr::pivot_longer()</code></a>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">od_disaggregate</span><span class="op">(</span></span>
<span>  <span class="va">od</span>,</span>
<span>  <span class="va">z</span>,</span>
<span>  subpoints <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  code_append <span class="op">=</span> <span class="st">"_ag"</span>,</span>
<span>  population_column <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_per_od <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  keep_ids <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  integer_outputs <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">od_split</span><span class="op">(</span></span>
<span>  <span class="va">od</span>,</span>
<span>  <span class="va">z</span>,</span>
<span>  subpoints <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  code_append <span class="op">=</span> <span class="st">"_ag"</span>,</span>
<span>  population_column <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_per_od <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  keep_ids <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  integer_outputs <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-od">od<a class="anchor" aria-label="anchor" href="#arg-od"></a></dt>
<dd><p>An origin-destination data frame</p></dd>


<dt id="arg-z">z<a class="anchor" aria-label="anchor" href="#arg-z"></a></dt>
<dd><p>Zones representing origins and destinations</p></dd>


<dt id="arg-subpoints">subpoints<a class="anchor" aria-label="anchor" href="#arg-subpoints"></a></dt>
<dd><p>Points, lines or polygons within the zones.
These define the OD data start/end points.</p></dd>


<dt id="arg-code-append">code_append<a class="anchor" aria-label="anchor" href="#arg-code-append"></a></dt>
<dd><p>The name of the column containing aggregate zone names</p></dd>


<dt id="arg-population-column">population_column<a class="anchor" aria-label="anchor" href="#arg-population-column"></a></dt>
<dd><p>The column containing the total population (if it exists)</p></dd>


<dt id="arg-max-per-od">max_per_od<a class="anchor" aria-label="anchor" href="#arg-max-per-od"></a></dt>
<dd><p>Maximum flow in the population_column to assign per OD pair.
This only comes into effect if there are enough subpoints to choose from.</p></dd>


<dt id="arg-keep-ids">keep_ids<a class="anchor" aria-label="anchor" href="#arg-keep-ids"></a></dt>
<dd><p>Should the origin and destination ids be kept?
<code>TRUE</code> by default, meaning 2 extra columns are appended, with the
names <code>o_agg</code> and <code>d_agg</code> containing IDs from the original OD data.</p></dd>


<dt id="arg-integer-outputs">integer_outputs<a class="anchor" aria-label="anchor" href="#arg-integer-outputs"></a></dt>
<dd><p>Should integer outputs be returned? <code>FALSE</code> by default.
Note: there is a known issue when integer results are generated. See
https://github.com/ITSLeeds/od/issues/31 for details.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>An alias for the function is <code>od_split()</code>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">od</span> <span class="op">=</span> <span class="va">od_data_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">9</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">od</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   geo_code1 geo_code2 bicycle</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 E02002384 E02006875      13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 E02002404 E02006875      10</span>
<span class="r-in"><span><span class="va">zones</span> <span class="op">=</span> <span class="fu">od</span><span class="fu">::</span><span class="va"><a href="od_data_zones.html">od_data_zones_min</a></span></span></span>
<span class="r-in"><span><span class="va">od_sf</span> <span class="op">=</span> <span class="fu"><a href="od_to_sf.html">od_to_sf</a></span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 origins with no match in zone ids</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 destinations with no match in zone ids</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  points not in od data removed.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span> <span class="co"># for reproducibility</span></span></span>
<span class="r-in"><span><span class="va">od_disag</span> <span class="op">=</span> <span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating origin and destination points at random locations</span>
<span class="r-in"><span><span class="va">od_disag2</span> <span class="op">=</span> <span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span>, max_per_od <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating origin and destination points at random locations</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">zones</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_sf</span><span class="op">$</span><span class="va">geometry</span>, lwd <span class="op">=</span> <span class="fl">9</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disag</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disag2</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"green"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="od_disaggregate-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">od_disag</span><span class="op">$</span><span class="va">o_agg</span>, <span class="va">od_disag</span><span class="op">$</span><span class="va">d_agg</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             E02006875</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   E02002384         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   E02002404         2</span>
<span class="r-in"><span><span class="co"># integer results</span></span></span>
<span class="r-in"><span><span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span>, integer_outputs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating origin and destination points at random locations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 5 features and 5 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: LINESTRING</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: -1.557405 ymin: 53.7873 xmax: -1.515148 ymax: 53.81147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geodetic CRS:  WGS 84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   o  d bicycle     o_agg     d_agg                       geometry</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2  9       4 E02002384 E02006875 LINESTRING (-1.556161 53.81...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 1  6       4 E02002384 E02006875 LINESTRING (-1.534144 53.80...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 3  8       5 E02002384 E02006875 LINESTRING (-1.552041 53.81...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 4 10       5 E02002404 E02006875 LINESTRING (-1.533423 53.79...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 5  7       5 E02002404 E02006875 LINESTRING (-1.515148 53.78...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># with more trips per disaggregated OD pair:</span></span></span>
<span class="r-in"><span><span class="va">disag</span> <span class="op">=</span> <span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od_data_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, z <span class="op">=</span> <span class="va">zones</span>, max_per_od <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating origin and destination points at random locations</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">disag</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="od_disaggregate-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># with subpoints</span></span></span>
<span class="r-in"><span><span class="va">subpoints</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">zones</span>, <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">od_disag_subpoints</span> <span class="op">=</span> <span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span>, subpoints <span class="op">=</span> <span class="va">subpoints</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">subpoints</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disag_subpoints</span><span class="op">$</span><span class="va">geometry</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="od_disaggregate-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># with buildings data</span></span></span>
<span class="r-in"><span><span class="va">od_disag_buildings</span> <span class="op">=</span> <span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span>, <span class="va">od_data_buildings</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting polygons to points</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>st_centroid assumes attributes are constant over geometries</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">od_disag_buildings</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       o                  d                bicycle         o_agg          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Length:5           Length:5           Min.   :4.333   Length:5          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Class :character   Class :character   1st Qu.:4.333   Class :character  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mode  :character   Mode  :character   Median :4.333   Mode  :character  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        Mean   :4.600                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        3rd Qu.:5.000                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        Max.   :5.000                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     d_agg                    geometry</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Length:5           LINESTRING   :5  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Class :character   epsg:4326    :0  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mode  :character   +proj=long...:0  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                      </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_data_buildings</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disag_buildings</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="od_disaggregate-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># mapview::mapview(od_disag_buildings)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">od</span> <span class="op">=</span> <span class="va">od_data_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">subzones</span> <span class="op">=</span> <span class="va">od_data_zones_small</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span>, <span class="va">subzones</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting polygons to points</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>st_centroid assumes attributes are constant over geometries</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in sample.int(length(x), size, replace, prob) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cannot take a sample larger than the population when 'replace = FALSE'</span>
<span class="r-in"><span><span class="va">od_disag</span> <span class="op">=</span> <span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span>, <span class="va">subzones</span>, max_per_od <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Converting polygons to points</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>st_centroid assumes attributes are constant over geometries</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">od_disag</span><span class="op">)</span> <span class="op">-</span><span class="fl">3</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span> <span class="co"># same number of columns, the same...</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># Except disag data gained geometry and new agg ids:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">od_disag</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">od</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">od_disag</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">od</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disag</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="od_disaggregate-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># test with road network dataset (don't run as time consuming):</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">od_disag_net</span> <span class="op">=</span> <span class="fu">od_disaggregate</span><span class="op">(</span><span class="va">od</span>, <span class="va">zones</span>, <span class="va">od_road_network</span>, max_per_od <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">zones</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_road_network</span><span class="op">$</span><span class="va">geometry</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disag_net</span><span class="op">$</span><span class="va">geometry</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">zones</span><span class="op">)</span> <span class="op">+</span> <span class="va">od_disag_net</span> <span class="op">+</span> <span class="va">od_road_network</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

