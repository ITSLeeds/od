<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to origin-destination data • od</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to origin-destination data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">od</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/od.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/itsleeds/od/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An introduction to origin-destination data</h1>
            <h3 data-toc-skip class="subtitle">A practical demonstration
with the R package od</h3>
                        <h4 data-toc-skip class="author">Robin Lovelace
and Edward Leigh</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/itsleeds/od/blob/v0.5.0/vignettes/od.Rmd" class="external-link"><code>vignettes/od.Rmd</code></a></small>
      <div class="hidden name"><code>od.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction-what-is-od-data">Introduction: what is OD data?<a class="anchor" aria-label="anchor" href="#introduction-what-is-od-data"></a>
</h2>
<p>As the name suggests, origin-destination (OD) data represents
movement through geographic space, from an origin (O) to a destination
(D). Sometimes also called ‘<a href="https://www.ons.gov.uk/census/2011census/2011censusdata/originanddestinationdata" class="external-link">flow
data</a>’, OD datasets contain details of trips between two geographic
points or, more commonly, zones (which are often represented by a zone
centroid). Most OD datasets refer to start and end locations with ‘ID’
columns containing character strings such as <code>zone1</code>. These
IDs refer to a geographic feature in a separate geographic dataset.
Origin and destination locations are sometimes represented as geographic
coordinates.</p>
<p>OD datasets typically contain multiple non geographic attributes.
These usually include, at a minimum, the number of trips that take place
from the origin to the destination over a given time period (e.g. a
typical work day). Additional attributes can include breakdown by the
mode(s) of transport used for the trips. Usually only a single mode is
captured (trips made by a combination of cycle-train-walk modes are
often counted only as ‘train’ trips). Additional disaggregations of
overall counts may include trip counts at different time periods.</p>
<p>Many OD datasets omit information. If there is only one time period,
then this resides in the metadata for the whole data set. There is
rarely any information about the path taken between the start and end
points. It is typically the job of the analyst to use a routing service
(such as <a href="https://github.com/riatelab/osrm" class="external-link">OSRM</a>, <a href="https://symbolixau.github.io/googleway/articles/googleway-vignette.html#google-directions-api" class="external-link">Google
Directions API</a>, <a href="https://github.com/Robinlovelace/cyclestreets/" class="external-link">CycleStreets.net</a>
or <a href="https://github.com/GIScience/openrouteservice-r/" class="external-link">OpenRouteService</a>)
or an assignment model to identify likely routes with reference to
shortest path algorithms or generalised cost minimisation algorithms
(which account for monetary plus time and quality ‘costs’).</p>
<div class="section level3">
<h3 id="the-importance-of-od-data">The importance of OD data<a class="anchor" aria-label="anchor" href="#the-importance-of-od-data"></a>
</h3>
<p>Despite the rather dull name, OD datasets are a vital part of the
modern world: they underpin analysis and models that influence current
<em>and future</em> transport systems. Historically, these models, and
the OD datasets that drove them, were used to plan for car-dominated
cities <span class="citation">(Boyce and Williams 2015)</span>. Now that
there is growing evidence of the negative impacts car domination,
however, there is a strong argument for transport models being
repurposed. Origin-destination data can be part of the solution.</p>
<p>From a health perspective transport planning, supported by OD data
and analysed primarily using proprietary software and opaque methods,
has failed: roads are now the largest cause of death of young people
worldwide, killing more than <a href="https://www.who.int/publications/i/item/9789241565684" class="external-link">1
million</a> people each year <span class="citation">(World Health
Organization 2018)</span>. Even ignoring problems such as air pollution,
obesity and climate change, it is clear that current transport systems
are unsustainable. There are other reasons why transport data analysis
and software are important <span class="citation">(Lovelace and Ellison
2018)</span>.</p>
<p>The purpose of this vignette is to introduce OD data, an important
component of many transport planning models, with examples based on data
and functions from the stplanr package. The aim is to enable you to use
OD data to inform more sustainable transport plans, for example by
identifying ‘desire lines’ along which policies could cause a modal
switch away from cars and towards lower energy modes such as walking,
cycling, and public transport.</p>
</div>
<div class="section level3">
<h3 id="the-od-package">The od package<a class="anchor" aria-label="anchor" href="#the-od-package"></a>
</h3>
<p>The <code>od</code> package was developed to provide a unified set of
functions for representing, transforming and working OD data. Like the
<code>stats19</code> and <code>cyclestreets</code> packages,
<code>od</code> started life as functions in the <code>stplanr</code>
package, which provides methods for working with a range of transport
datasets, focussed on geographic representations and sustainable modes
<span class="citation">(Lovelace and Ellison 2018)</span>.</p>
<p>Install and load the package as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"od"</span><span class="op">)</span></span>
<span><span class="co"># remotes::install_github("itsleeds/od") # for the dev version</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/itsleeds/od" class="external-link">od</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="representing-origin-destination-data">Representing origin-destination data<a class="anchor" aria-label="anchor" href="#representing-origin-destination-data"></a>
</h2>
<p>OD data can be accessed from a range of sources (we will see code
that downloads many thousands of OD pairs later in this vignette). Some
‘data carpentry’ may be needed before the OD data is ready for analysis.
This vignette does not cover cleaning OD data: we assume you know R and
come with ‘tidy’ data <span class="citation">(Wickham 2014)</span>, in
which each row represents travel between an origin and a destination
(typically zones represented by zone IDs), and each column represents an
attribute such as number of trips or vehichle counts by mode or straight
line distance.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="section level3">
<h3 id="a-minimal-od-dataset">A minimal od dataset<a class="anchor" aria-label="anchor" href="#a-minimal-od-dataset"></a>
</h3>
<p>At its most basic, a single trip can be OD data, as illustrated in
the simple example dataset below. The concept can be illustrated by an
example of travel between two cities. As mentioned above, OD data is a
data frame that contains at least two columns, one representing an
origin and one representing a destination. The code below creates a data
frame with one row representing movement between the cities of Leeds and
London:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_data_example</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  o <span class="op">=</span> <span class="st">"Leeds"</span>,</span>
<span>  d <span class="op">=</span> <span class="st">"London"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">od_data_example</span></span>
<span><span class="co">#&gt;       o      d</span></span>
<span><span class="co">#&gt; 1 Leeds London</span></span></code></pre></div>
<p>Most OD datasets have attributes associated with movement between the
two places. In this case we can represent the number of trips I make
from Leeds to London per year with a new column as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_data_example</span><span class="op">$</span><span class="va">trips_per_year</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">od_data_example</span></span>
<span><span class="co">#&gt;       o      d trips_per_year</span></span>
<span><span class="co">#&gt; 1 Leeds London             10</span></span></code></pre></div>
<p>Furthermore, if we have geographic representations of the origin and
destination datasets, in a separate object called <code>p</code> (short
for points) we can create a geographical representation of the data as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Leeds"</span>, <span class="st">"London"</span><span class="op">)</span>,</span>
<span>    lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">53.8</span>, <span class="fl">51.5</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">4326</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">p</span></span>
<span><span class="co">#&gt; Simple feature collection with 2 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -1.5 ymin: 51.5 xmax: -0.1 ymax: 53.8</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;     name          geometry</span></span>
<span><span class="co">#&gt; 1  Leeds POINT (-1.5 53.8)</span></span>
<span><span class="co">#&gt; 2 London POINT (-0.1 51.5)</span></span></code></pre></div>
<p>This can be plotted as follows (result from mapview shown):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://user-images.githubusercontent.com/1825120/78998042-b18a2c00-7b3f-11ea-9d08-21be332633fc.png"><!-- --></p>
<p>The plot above shows that OD datasets are fundamentally geographic,
although they are not always represented geographically. To convert the
non-geographic OD dataset into a geographic object, we can use the
<code><a href="../reference/od_to_sf.html">od_to_sf()</a></code> function from the <code>od</code> package as
follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">desire_line_example</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_to_sf.html">od_to_sf</a></span><span class="op">(</span><span class="va">od_data_example</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0 origins with no match in zone ids</span></span>
<span><span class="co">#&gt; 0 destinations with no match in zone ids</span></span>
<span><span class="co">#&gt;  points not in od data removed.</span></span>
<span><span class="va">desire_line_example</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -1.5 ymin: 51.5 xmax: -0.1 ymax: 53.8</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;       o      d trips_per_year                       geometry</span></span>
<span><span class="co">#&gt; 1 Leeds London             10 LINESTRING (-1.5 53.8, -0.1...</span></span></code></pre></div>
<p>We just converted the data frame into a ‘geographic data frame’, with
the origin-destination data represented geographically as a straight
‘desire line’ between the origin and destination point. This can be
useful for many things, not least visualisation, as shown below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">desire_line_example</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://user-images.githubusercontent.com/1825120/78998661-f6fb2900-7b40-11ea-88a5-429f7dae31af.png"><!-- --></p>
</div>
<div class="section level3">
<h3 id="od-data-representing-travel-to-work">OD data representing travel to work<a class="anchor" aria-label="anchor" href="#od-data-representing-travel-to-work"></a>
</h3>
<p>This next example uses a small dataset that comes pre-loaded with the
package, called <code>od_data_df</code>. We will copy it into an object
called <code>od</code> to be concise, and to highlight the fact that
these operations can be generalised to many OD datasets.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example data from the od package:</span></span>
<span><span class="va">od</span> <span class="op">=</span> <span class="fu">od</span><span class="fu">::</span><span class="va"><a href="../reference/od_data_df.html">od_data_df</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "data.frame"</span></span></code></pre></div>
<p>Like all data, the object <code>od</code>, created in the preceding
code chunk, comes from a specific context, the 2011 <a href="https://ukdataservice.ac.uk/learning-hub/census/" class="external-link">UK Census</a>
questions:</p>
<ul>
<li>In your main job, what is the address of your workplace?</li>
<li>How do you usually travel to work (for the longest part, by
distance, of your usual journey to work)?
<ul>
<li>Work mainly at or from home</li>
<li>Underground, metro, light rail, tram</li>
<li>Train</li>
<li>…</li>
</ul>
</li>
</ul>
<p><code>od</code> is an origin-destination dataset represented as a
data frame containing aggregated answers to these questions (see
<code>?pct::get_od()</code> for details). It is <em>implicitly
geographic</em>: the first two columns refer to geographic entities but
do not contain coordinates themselves (OD coordinates are covered
below). Other columns contain attributes associated with each OD pair,
typically counting how many people travel by mode of transport, as shown
by printing the contents of <code>od</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od</span></span>
<span><span class="co">#&gt;   geo_code1 geo_code2  all train bus taxi car_driver car_passenger bicycle foot</span></span>
<span><span class="co">#&gt; 1 E02002384 E02006875  966    14 153   14         69            18      13  679</span></span>
<span><span class="co">#&gt; 2 E02002404 E02006875 1145     6 174   17         96            38      10  798</span></span>
<span><span class="co">#&gt; 3 E02006875 E02006875 1791    21  38    5         69             7       8 1637</span></span>
<span><span class="co">#&gt; 4 E02006876 E02006875 1035    11 132    6         97            24      10  749</span></span>
<span><span class="co">#&gt; 5 E02006861 E02002392  453     1  51    0         51             6      26  317</span></span>
<span><span class="co">#&gt; 6 E02006875 E02002392  286     2  15    5         16             2      10  235</span></span>
<span><span class="co">#&gt; 7 E02002392 E02006875  753    10  91   21         33             7      19  571</span></span></code></pre></div>
<p>OD data can be represented in a number of ways, as outlined in the
next sections.</p>
</div>
<div class="section level3">
<h3 id="origin-destination-pairs-long-form">Origin-destination pairs (long form)<a class="anchor" aria-label="anchor" href="#origin-destination-pairs-long-form"></a>
</h3>
<p>The most common way of representing OD data in the 21<sup>st</sup>
century is the ‘long’ data frame format described above. This is
increasingly the format used by official statistical agencies, including
the UK’s Office for National Statistics (ONS), who provide origin
destination data as a <code>.csv</code> file. Typically, the first
column is the zone code of origin and the second column is the zone code
of the destination, as is the case with the object <code>od</code>.
Subsequent columns contain attributes such as <code>all</code>, meaning
trips by all modes, as illustrated below (we will see a matrix
representation of this subset of the data in the next section):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt;   geo_code1 geo_code2  all</span></span>
<span><span class="co">#&gt; 1 E02002384 E02006875  966</span></span>
<span><span class="co">#&gt; 2 E02002404 E02006875 1145</span></span>
<span><span class="co">#&gt; 3 E02006875 E02006875 1791</span></span>
<span><span class="co">#&gt; 4 E02006876 E02006875 1035</span></span>
<span><span class="co">#&gt; 5 E02006861 E02002392  453</span></span>
<span><span class="co">#&gt; 6 E02006875 E02002392  286</span></span>
<span><span class="co">#&gt; 7 E02002392 E02006875  753</span></span></code></pre></div>
<p><code>geo_code1</code> refers to the origin, <code>geo_code2</code>
refers to the destination.</p>
<p>Additional columns can represent addition attributes, such as number
of trips by time, mode of travel, type of person, or trip purpose. The
<code>od</code> dataset contains column names representing mode of
travel (train, bus, bicycle etc), as can be seen with
<code>names(od[-(1:2)])</code>. These ‘mode’ columns contain integers in
the example data, but contain characters, dates and other data types,
taking advantage of the flexibility of data frames.</p>
</div>
<div class="section level3">
<h3 id="origin-destination-matrices">Origin destination matrices<a class="anchor" aria-label="anchor" href="#origin-destination-matrices"></a>
</h3>
<p>The ‘OD matrix’ representation of OD data represents each attribute
column in the long form as a separate matrix. Instead of rows
representing OD pairs, rows represent all travel from each origin to all
destinations (represented as columns). The <strong>stplanr</strong>
function <code><a href="../reference/od_to_odmatrix.html">od_to_odmatrix()</a></code> converts between the ‘long’ to
the ‘matrix’ form on a per column basis, as illustrated below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_matrix</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_to_odmatrix.html">od_to_odmatrix</a></span><span class="op">(</span><span class="va">od</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">od_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "matrix" "array"</span></span>
<span><span class="va">od_matrix</span></span>
<span><span class="co">#&gt;           E02006875 E02002392</span></span>
<span><span class="co">#&gt; E02002384       966        NA</span></span>
<span><span class="co">#&gt; E02002404      1145        NA</span></span>
<span><span class="co">#&gt; E02006875      1791       286</span></span>
<span><span class="co">#&gt; E02006876      1035        NA</span></span>
<span><span class="co">#&gt; E02006861        NA       453</span></span>
<span><span class="co">#&gt; E02002392       753        NA</span></span></code></pre></div>
<p>Note that row and column names are now zone codes. The cell in row 1
and column 2 (<code>od_matrix[1, 2]</code>), for example, reports that
there are 94 trips from zone <code>E02002361</code> to zone
<code>E02002393</code>. In the case above, no people travel between the
majority of the OD pair combinations, as represented by the
<code>NA</code>s. OD matrices are a relatively rudimentary data
structure that pre-date R’s <code>data.frame</code> class. Typically,
they only contained integer counts, providing small and simple datasets
that could be used in 20<sup>th</sup> Century transport modelling
software running on limited 20<sup>th</sup> Century hardware.</p>
<p>Although ‘OD matrix’ is still sometimes used informally to refer to
any OD datadset, the long OD pair representation is recommended: OD
matrices become unwieldy for large OD datasets, which are likely to be
sparse, with many empty cells represented by NAs. Furthermore, to
represent many attributes in matix format, multiple lists of OD matrices
or ‘OD arrays’ must be created. This is demonstrated in the code chunk
below, which represents travel between OD pairs by all modes and by
bike:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"bicycle"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/od_to_odmatrix.html">od_to_odmatrix</a></span><span class="op">(</span><span class="va">od</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geo_code1"</span>, <span class="st">"geo_code2"</span>, <span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;           E02006875 E02002392</span></span>
<span><span class="co">#&gt; E02002384       966        NA</span></span>
<span><span class="co">#&gt; E02002404      1145        NA</span></span>
<span><span class="co">#&gt; E02006875      1791       286</span></span>
<span><span class="co">#&gt; E02006876      1035        NA</span></span>
<span><span class="co">#&gt; E02006861        NA       453</span></span>
<span><span class="co">#&gt; E02002392       753        NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;           E02006875 E02002392</span></span>
<span><span class="co">#&gt; E02002384        13        NA</span></span>
<span><span class="co">#&gt; E02002404        10        NA</span></span>
<span><span class="co">#&gt; E02006875         8        10</span></span>
<span><span class="co">#&gt; E02006876        10        NA</span></span>
<span><span class="co">#&gt; E02006861        NA        26</span></span>
<span><span class="co">#&gt; E02002392        19        NA</span></span></code></pre></div>
<p>The function <code><a href="../reference/odmatrix_to_od.html">odmatrix_to_od()</a></code> can convert OD matrices
back into the more convenient long form:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/odmatrix_to_od.html">odmatrix_to_od</a></span><span class="op">(</span><span class="va">od_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt;         orig      dest flow</span></span>
<span><span class="co">#&gt; 1  E02002384 E02006875  966</span></span>
<span><span class="co">#&gt; 6  E02002392 E02006875  753</span></span>
<span><span class="co">#&gt; 2  E02002404 E02006875 1145</span></span>
<span><span class="co">#&gt; 11 E02006861 E02002392  453</span></span>
<span><span class="co">#&gt; 9  E02006875 E02002392  286</span></span>
<span><span class="co">#&gt; 3  E02006875 E02006875 1791</span></span>
<span><span class="co">#&gt; 4  E02006876 E02006875 1035</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inter-and-intra-zonal-flows">Inter and intra-zonal flows<a class="anchor" aria-label="anchor" href="#inter-and-intra-zonal-flows"></a>
</h3>
<p>A common, and sometimes problematic, feature of OD data is
‘intra-zonal flows’. These are trips that start and end in the same
zone. The proportion of travel that is intra-zonal depends largely on
the size of the zones used. It is often useful to separate intra-zonal
and inter-zonal flows at the outset, as demonstrated below:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">od_inter</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_interzone.html">od_interzone</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   geo_code1 geo_code2  all train bus taxi car_driver car_passenger bicycle foot</span></span>
<span><span class="co">#&gt; 1 E02002384 E02006875  966    14 153   14         69            18      13  679</span></span>
<span><span class="co">#&gt; 2 E02002404 E02006875 1145     6 174   17         96            38      10  798</span></span>
<span><span class="co">#&gt; 4 E02006876 E02006875 1035    11 132    6         97            24      10  749</span></span>
<span><span class="co">#&gt; 5 E02006861 E02002392  453     1  51    0         51             6      26  317</span></span>
<span><span class="co">#&gt; 6 E02006875 E02002392  286     2  15    5         16             2      10  235</span></span>
<span><span class="co">#&gt; 7 E02002392 E02006875  753    10  91   21         33             7      19  571</span></span>
<span><span class="op">(</span><span class="va">od_intra</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_interzone.html">od_intrazone</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   geo_code1 geo_code2  all train bus taxi car_driver car_passenger bicycle foot</span></span>
<span><span class="co">#&gt; 3 E02006875 E02006875 1791    21  38    5         69             7       8 1637</span></span></code></pre></div>
<p>Intra-zonal OD pairs represent short trips (up to the size of the
zone within which the trips take place) so are sometimes ignored in OD
data analyis. However, intra-zonal flows can be valuable, for example in
measuring the amount of localised transport activity and as a sign of
local economic activity.</p>
</div>
<div class="section level3">
<h3 id="bidirectional-aggregation">Bidirectional aggregation<a class="anchor" aria-label="anchor" href="#bidirectional-aggregation"></a>
</h3>
<p>Another subtly with some (<a href="https://icaci.org/files/documents/ICC_proceedings/ICC2013/_extendedAbstract/393_proceeding.pdf" class="external-link">symetric</a>,
where origins and destinations can be the same points) OD data is that
oneway flows can hide the extent of bidirectional flows in plots and
other types of analysis. This is illustrated below for a sample of the
<code>od</code> dataset:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">od_min</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">od</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   geo_code1 geo_code2 all train bus taxi car_driver car_passenger bicycle foot</span></span>
<span><span class="co">#&gt; 5 E02006861 E02002392 453     1  51    0         51             6      26  317</span></span>
<span><span class="co">#&gt; 6 E02006875 E02002392 286     2  15    5         16             2      10  235</span></span>
<span><span class="co">#&gt; 7 E02002392 E02006875 753    10  91   21         33             7      19  571</span></span>
<span><span class="op">(</span><span class="va">od_oneway</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_oneway.html">od_oneway</a></span><span class="op">(</span><span class="va">od_min</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           o         d  all train bus taxi car_driver car_passenger bicycle foot</span></span>
<span><span class="co">#&gt; 1 E02002392 E02006861  453     1  51    0         51             6      26  317</span></span>
<span><span class="co">#&gt; 2 E02002392 E02006875 1039    12 106   26         49             9      29  806</span></span></code></pre></div>
<p>Note that in the second dataset there are only 2 rows instead of 3.
The function <code><a href="../reference/od_oneway.html">od_oneway()</a></code> aggregates oneway lines to produce
bidirectional flows. By default, it returns the sum of each numeric
column for each bidirectional origin-destination pair.</p>
</div>
<div class="section level3">
<h3 id="desire-lines">Desire lines<a class="anchor" aria-label="anchor" href="#desire-lines"></a>
</h3>
<p>The previous representations of OD data are all implicitly
geographic: their coordinates are not contained in the data, but
associated with another object that <em>is</em> geographic, typically a
zone or a zone centroid. This is problematic, meaning that multiple
objects or files are required to fully represent the same data. Desire
line representations overcome this issue. They are geographic lines
between origin and destination, with the same attributes as in the
‘long’ representation.</p>
<p><code><a href="../reference/od_to_sf.html">od_to_sf()</a></code> can convert long form OD data to desire
lines. The second argument is a zone or a centroid dataset that contains
‘zone IDs’ that match the IDs in the first and second columns of the OD
data, as illustrated below:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">=</span> <span class="fu">od</span><span class="fu">::</span><span class="va"><a href="../reference/od_data_zones.html">od_data_zones_min</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sf"         "data.frame"</span></span>
<span><span class="va">desire_lines</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_to_sf.html">od_to_sf</a></span><span class="op">(</span><span class="va">od_inter</span>, <span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0 origins with no match in zone ids</span></span>
<span><span class="co">#&gt; 0 destinations with no match in zone ids</span></span>
<span><span class="co">#&gt;  points not in od data removed.</span></span></code></pre></div>
<p>The preceding code chunk created a zones object called
<code>z</code>, the coordinates of which were used to convert the object
<code>od</code> into <code>desire_lines</code>, which are geographic
desire lines. The desire line object is stored in as a geographic simple
features object, which has the same number of rows as does the object
<code>od</code> and one more column:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">desire_lines</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sf"         "data.frame"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">desire_lines</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">desire_lines</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>The new column is the geometry column, which can be plotted as
follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">desire_lines</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span></code></pre></div>
<p><img src="od_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>By default, plotting <code>desire_lines</code> shows the attributes
for each line:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">desire_lines</span><span class="op">)</span></span></code></pre></div>
<p><img src="od_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>Because these lines have a coordinate reference system (CRS)
inherited from the zones data, they can also be plotted on an
interactive map, as follows (result not shown, requires the
<code>tmap</code> package):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="fu">tmap_mode</span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span></span>
<span><span class="fu">qtm</span><span class="op">(</span><span class="va">desire_lines</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="non-matching-ids">Non-matching IDs<a class="anchor" aria-label="anchor" href="#non-matching-ids"></a>
</h3>
<p>Note that in some OD datasets there may be IDs that match no zone. We
can simulate this situation by setting the third origin ID of
<code>od</code> to <code>nomatch</code>, a string that is not in the
zones ID:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_geo_code2_3</span> <span class="op">=</span> <span class="va">od</span><span class="op">$</span><span class="va">geo_code2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">od</span><span class="op">$</span><span class="va">geo_code2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">"nomatch"</span></span>
<span><span class="fu"><a href="../reference/od_to_sf.html">od_to_sf</a></span><span class="op">(</span><span class="va">od</span>, <span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0 origins with no match in zone ids</span></span>
<span><span class="co">#&gt; 1 destinations with no match in zone ids</span></span>
<span><span class="co">#&gt;  points not in od data removed.</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 10 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -1.564756 ymin: 53.77475 xmax: -1.517695 ymax: 53.81763</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   geo_code1 geo_code2  all train bus taxi car_driver car_passenger bicycle foot</span></span>
<span><span class="co">#&gt; 1 E02002384 E02006875  966    14 153   14         69            18      13  679</span></span>
<span><span class="co">#&gt; 2 E02002404 E02006875 1145     6 174   17         96            38      10  798</span></span>
<span><span class="co">#&gt; 3 E02006876 E02006875 1035    11 132    6         97            24      10  749</span></span>
<span><span class="co">#&gt; 4 E02006861 E02002392  453     1  51    0         51             6      26  317</span></span>
<span><span class="co">#&gt; 5 E02006875 E02002392  286     2  15    5         16             2      10  235</span></span>
<span><span class="co">#&gt; 6 E02002392 E02006875  753    10  91   21         33             7      19  571</span></span>
<span><span class="co">#&gt;                         geometry</span></span>
<span><span class="co">#&gt; 1 LINESTRING (-1.54473 53.809...</span></span>
<span><span class="co">#&gt; 2 LINESTRING (-1.51871 53.792...</span></span>
<span><span class="co">#&gt; 3 LINESTRING (-1.517695 53.77...</span></span>
<span><span class="co">#&gt; 4 LINESTRING (-1.564756 53.81...</span></span>
<span><span class="co">#&gt; 5 LINESTRING (-1.546024 53.79...</span></span>
<span><span class="co">#&gt; 6 LINESTRING (-1.561391 53.80...</span></span></code></pre></div>
<p>Note the message saying that the non-matching row was removed (the
equivalent code from the <code>stplanr</code> package generated an error
message). It’s worth checking/cleaning your OD data and ensure all ids
in the first two columns match the ids in the first column of the zone
data before running <code><a href="../reference/od_to_sf.html">od_to_sf()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od</span><span class="op">$</span><span class="va">geo_code2</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">od_geo_code2_3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aggregating-and-disaggregating-od-data">Aggregating and disaggregating OD data<a class="anchor" aria-label="anchor" href="#aggregating-and-disaggregating-od-data"></a>
</h3>
<p>The data shown in the previous examples is quite low resolution.
Imagine you want to split each desire line into multiple lines, e.g. for
some kind of simulation. You can do this by assigning origins and
destinations to specific subzones with <code><a href="../reference/od_disaggregate.html">od_disaggregate()</a></code>
(also called <code><a href="../reference/od_disaggregate.html">od_split()</a></code>):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od</span> <span class="op">=</span> <span class="va">od_data_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">9</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">subzones</span> <span class="op">=</span> <span class="va">od_data_zones_small</span></span>
<span><span class="va">od_disaggregated</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_disaggregate.html">od_disaggregate</a></span><span class="op">(</span><span class="va">od</span>, <span class="va">z</span>, subpoints <span class="op">=</span> <span class="va">subzones</span>, max_per_od <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Converting polygons to points</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_data_zones_min</span><span class="op">$</span><span class="va">geometry</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_data_zones_small</span><span class="op">$</span><span class="va">geometry</span>, lwd <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">desire_lines</span><span class="op">$</span><span class="va">geometry</span>, lwd <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disaggregated</span><span class="op">$</span><span class="va">geometry</span>, lwd <span class="op">=</span> <span class="fl">0.4</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="od_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot(od_disaggregated$geometry[1:5])</span></span></code></pre></div>
<p>This preserves column totals:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">od</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 23 20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">od_disaggregated</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 23 20</span></span></code></pre></div>
<p>This also allows the simulation of building-to-building travel.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_disaggregated2</span> <span class="op">=</span> <span class="fu"><a href="../reference/od_disaggregate.html">od_disaggregate</a></span><span class="op">(</span><span class="va">od</span>, <span class="va">z</span>, subpoints <span class="op">=</span> <span class="va">od_data_buildings</span><span class="op">)</span></span>
<span><span class="co">#&gt; Converting polygons to points</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_data_buildings</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">od_disaggregated2</span><span class="op">$</span><span class="va">geometry</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="od_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<!-- You can re-aggregate the data with the function `od_aggregate()`. -->
<!-- Note: this functionality is work in progress. -->
<!-- # Worked example -->
<!-- Todo: add this from the stplanr od vignette. -->
</div>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>Despite the importance of origin-destination datasets for transport
research, there are few guides dedicated to working with them using open
source software. The following suggestions are based on my own reading —
if you have any other suggestions of good resources for working with OD
data, let me know!</p>
<ul>
<li>Section <a href="https://r.geocompx.org/transport.html" class="external-link">12.4</a> of
<em>Geocomputation with R</em> <span class="citation">(Lovelace,
Nowosad, and Muenchow 2019)</span> puts OD data in the wider context of
geographic transport data.</li>
<li>
<span class="citation">Martin et al. (2018)</span> describe methods
for classifying OD pairs based on demographic data.</li>
<li>The <a href="https://kepler.gl/demo/ukcommute" class="external-link">kepler.gl</a> website
provides a nifty web application for visualising OD data.</li>
<li>Documentation for the open source microscopic transport modelling
software <a href="https://sumo.dlr.de/userdoc/Demand/Importing_O/D_Matrices.html" class="external-link">SUMO</a>
describes ways of reading-in OD file formats not covered in this
vignette.</li>
<li>An excellent introduction to modelling and visualising OD data in
the <a href="https://github.com/riatelab/flows/blob/master/vignettes/flows.Rmd" class="external-link">introductory
vignette</a> of the <code>flows</code> R package.</li>
</ul>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-boyce_forecasting_2015" class="csl-entry">
Boyce, David E., and Huw C. W. L. Williams. 2015. <em>Forecasting Urban
Travel: Past, Present and Future</em>. Edward Elgar Publishing.
</div>
<div id="ref-lovelace_stplanr_2018" class="csl-entry">
Lovelace, Robin, and Richard Ellison. 2018. <span>“Stplanr: A Package
for Transport Planning.”</span> <em>The R Journal</em> 10 (2): 7–23. <a href="https://doi.org/10.32614/RJ-2018-053" class="external-link">https://doi.org/10.32614/RJ-2018-053</a>.
</div>
<div id="ref-lovelace_geocomputation_2019" class="csl-entry">
Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2019.
<em>Geocomputation with R</em>. CRC Press. <a href="https://r.geocompx.org/" class="external-link">https://r.geocompx.org/</a>.
</div>
<div id="ref-martin_origindestination_2018" class="csl-entry">
Martin, David, Christopher Gale, Samantha Cockings, and Andrew Harfoot.
2018. <span>“Origin-Destination Geodemographics for Analysis of Travel
to Work Flows.”</span> <em>Computers, Environment and Urban Systems</em>
67 (January): 68–79. <a href="https://doi.org/10.1016/j.compenvurbsys.2017.09.002" class="external-link">https://doi.org/10.1016/j.compenvurbsys.2017.09.002</a>.
</div>
<div id="ref-wickham_tidy_2014" class="csl-entry">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>The Journal of
Statistical Software</em> 14 (5). <a href="https://vita.had.co.nz/papers/tidy-data.pdf" class="external-link">https://vita.had.co.nz/papers/tidy-data.pdf</a>.
</div>
<div id="ref-worldhealthorganization_global_2018" class="csl-entry">
World Health Organization. 2018. <em>Global Status Report On Road Safety
2018</em>. S.l. <a href="https://www.who.int/publications/i/item/9789241565684" class="external-link">https://www.who.int/publications/i/item/9789241565684</a>.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p> It may be difficult to convert between ‘number of trip’
and ‘number of vehicle’ counts for modes in which a single vehicle can
contain many people, such as cars (a problem that can be overcome when
surveys differentiate between car driver and ‘car passenger’ as distinct
modes), buses and trams if occupancy levels are unknown. Typically OD
data only report single stage trips, but multi-modal trips such as
walk-rail-cycle can be represented when such a combination of modes is
represented by a new, unique, mode.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
