<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools for Origin-Destination Data • od</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools for Origin-Destination Data">
<meta property="og:description" content="The aim of od is to provide tools and example datasets for working with
  origin-destination (OD) datasets. The package originated as a set of functions in
  the package stplanr for working with origin-destination data but has since 
  evolved to improve computational efficiency, provide new functions
  and updated example data. With minimal dependencies the package also aims to make
  developing new functions for working with od data straighforward, with od datasets
  based on the data.frame class.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">od</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/od.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/itsleeds/od/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="od" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#od" class="anchor"></a>od</h1></div>
<!-- badges: start -->

<p>The goal of od is to provide tools and example datasets for working with origin-destination (OD) datasets.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<!-- You can install the released version of od from [CRAN](https://CRAN.R-project.org) with: 

``` r
install.packages("od")
```

And the development version from [GitHub](https://github.com/) with:

-->
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"itsleeds/od"</span>)</pre></div>
</div>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>The package originated as a set of functions in the package <code>stplanr</code> for working with origin-destination data. The <code>od2line()</code> function, for example, takes a data frame and a spatial object as inputs and outputs geographic lines representing movement between origins and destinations:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">od</span>) <span class="co"># load example datasets</span>
<span class="no">od_data_df</span> <span class="co"># OD data as data frame</span>
<span class="co">#&gt;   geo_code1 geo_code2  all train bus taxi car_driver car_passenger bicycle foot</span>
<span class="co">#&gt; 1 E02002363 E02006875  922     5 356    7        375            76      43   53</span>
<span class="co">#&gt; 2 E02002373 E02006875 1037   111 424   20        155            30      73  214</span>
<span class="co">#&gt; 3 E02002385 E02006875  958   121 334   19        118            25      52  283</span>
<span class="co">#&gt; 4 E02006852 E02002392  437     1  96    3        142            26      61  108</span>
<span class="co">#&gt; 5 E02006852 E02006875 1221    14 509   13        401            50      99  118</span>
<span class="co">#&gt; 6 E02006861 E02006875 1177    43 400   30        123            28      56  492</span>
<span class="no">od_data_centroids</span>[<span class="fl">1</span>:<span class="fl">2</span>, ]
<span class="co">#&gt;    geo_code             geometry</span>
<span class="co">#&gt; 1 E02002407 -1.609934, 53.790790</span>
<span class="co">#&gt; 2 E02002336   -1.62463, 53.88605</span>
<span class="no">desire_lines_stplanr</span> <span class="kw">=</span> <span class="kw pkg">stplanr</span><span class="kw ns">::</span><span class="fu">od2line</span>(<span class="no">od_data_df</span>, <span class="no">od_data_centroids</span>)
<span class="no">desire_lines_stplanr</span>[<span class="fl">1</span>:<span class="fl">2</span>, <span class="fl">1</span>:<span class="fl">9</span>]
<span class="co">#&gt; Simple feature collection with 2 features and 9 fields</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -1.581773 ymin: 53.79593 xmax: -1.534957 ymax: 53.82859</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt;   geo_code1 geo_code2  all train bus taxi car_driver car_passenger bicycle</span>
<span class="co">#&gt; 1 E02002363 E02006875  922     5 356    7        375            76      43</span>
<span class="co">#&gt; 2 E02002373 E02006875 1037   111 424   20        155            30      73</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 LINESTRING (-1.534957 53.82...</span>
<span class="co">#&gt; 2 LINESTRING (-1.581773 53.81...</span></pre></div>
<p>It works great, and is plenty fast enough for most applications, but there are some issues with <code>stplanr::od2line()</code> (which also affect the other <code>od_*()</code> functions in <code>stplanr</code>):</p>
<ul>
<li>The function is a commonly needed and low-level function, buried in a large package, reducing ‘findability’</li>
<li>To get the function you must install <code>stplanr</code> plus its numerous dependencies</li>
<li>The function has not been optimised</li>
<li>It has no class definition of ‘od’ data</li>
</ul>
<p>The <code>od</code> package, as it currently stands, addresses the first three of these issues (it may at some point define a class for <code>od</code> objects but there are no immediate plans to do so).</p>
<p>The equivalent code in the <code>od</code> package is as follows:</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">desire_lines_od</span> <span class="kw">=</span> <span class="fu"><a href="reference/od_to_sf.html">od_to_sfc</a></span>(<span class="no">od_data_df</span>, <span class="no">od_data_centroids</span>)</pre></div>
<p>The result is an <code>sfc</code> object that has the same geometry as the output from <code>od2line</code>:</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">desire_lines_od</span>[<span class="fl">1</span>:<span class="fl">2</span>]
<span class="co">#&gt; Geometry set for 2 features </span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -1.581773 ymin: 53.79593 xmax: -1.534957 ymax: 53.82859</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt; LINESTRING (-1.534957 53.82859, -1.545708 53.79...</span>
<span class="co">#&gt; LINESTRING (-1.581773 53.8186, -1.545708 53.79593)</span>
<span class="no">desire_lines_stplanr</span>$<span class="no">geometry</span>[<span class="fl">1</span>:<span class="fl">2</span>]
<span class="co">#&gt; Geometry set for 2 features </span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -1.581773 ymin: 53.79593 xmax: -1.534957 ymax: 53.82859</span>
<span class="co">#&gt; geographic CRS: WGS 84</span>
<span class="co">#&gt; LINESTRING (-1.534957 53.82859, -1.545708 53.79...</span>
<span class="co">#&gt; LINESTRING (-1.581773 53.8186, -1.545708 53.79593)</span></pre></div>
<p>These are ‘desire lines’ representing the shortest (straight line) path between two centoids and can plotted using geographic data and mapping packages such as <code>sf</code>, <code>mapview</code>, <code>tmap</code> and <code>mapdeck</code>, e.g.:</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">desire_lines_od</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">desire_lines_stplanr</span>$<span class="no">geometry</span>)</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="50%"><img src="reference/figures/README-unnamed-chunk-5-2.png" width="50%"></p>
<p>By default the package uses the <code>sfheaders</code> package to create sf objects. You can can also specify <code>sf</code> outputs as follows:</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">desire_lines_od_sf1</span> <span class="kw">=</span> <span class="fu"><a href="reference/od_to_sf.html">od_to_sf</a></span>(<span class="no">od_data_df</span>, <span class="no">od_data_centroids</span>)</pre></div>
</div>
<div id="performance" class="section level2">
<h2 class="hasAnchor">
<a href="#performance" class="anchor"></a>Performance</h2>
<p>The package is designed to be fast, with centroids only created when needed and the use of <code>sfheaders</code>.</p>
<div id="benchmark-on-a-small-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#benchmark-on-a-small-dataset" class="anchor"></a>Benchmark on a small dataset:</h3>
<div class="sourceCode" id="cb7"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">od_data_df</span>)
<span class="co">#&gt; [1] 6</span>
<span class="kw pkg">bench</span><span class="kw ns">::</span><span class="fu">mark</span>(<span class="kw">check</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">max_iterations</span> <span class="kw">=</span> <span class="fl">100</span>,
  <span class="kw">stplanr</span> <span class="kw">=</span> <span class="kw pkg">stplanr</span><span class="kw ns">::</span><span class="fu">od2line</span>(<span class="no">od_data_df</span>, <span class="no">od_data_zones</span>),
  <span class="kw">od</span> <span class="kw">=</span> <span class="fu"><a href="reference/od_to_sf.html">od_to_sfc</a></span>(<span class="no">od_data_df</span>, <span class="no">od_data_zones</span>),
  <span class="kw">od_sf1</span> <span class="kw">=</span> <span class="fu"><a href="reference/od_to_sf.html">od_to_sf</a></span>(<span class="no">od_data_df</span>, <span class="no">od_data_zones</span>),
  <span class="kw">od_sf2</span> <span class="kw">=</span> <span class="fu"><a href="reference/od_to_sf.html">od_to_sf</a></span>(<span class="no">od_data_df</span>, <span class="no">od_data_zones</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"sf"</span>, <span class="kw">crs</span> <span class="kw">=</span> <span class="fl">4326</span>)
)
<span class="co">#&gt; # A tibble: 4 x 6</span>
<span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span>
<span class="co">#&gt;   &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 stplanr      4.64ms      5ms      196.   596.5KB     11.4</span>
<span class="co">#&gt; 2 od           2.32ms   2.46ms      386.    78.2KB     11.9</span>
<span class="co">#&gt; 3 od_sf1       2.61ms    2.8ms      339.      74KB     10.5</span>
<span class="co">#&gt; 4 od_sf2        2.6ms   2.73ms      344.      87KB     14.3</span></pre></div>
</div>
</div>
<div id="related-open-source-projects" class="section level2">
<h2 class="hasAnchor">
<a href="#related-open-source-projects" class="anchor"></a>Related open source projects</h2>
<ul>
<li>
<a href="https://github.com/ropensci/stplanr/">stplanr</a> is an R package package designed to support transport planning, with a focus on geographic transport datasets and many functions for working with OD data in the <a href="https://docs.ropensci.org/stplanr/reference/index.html#section-work-with-od-data">od function family</a>.</li>
<li>
<a href="http://riatelab.github.io/cartography">cartography</a> is an R package with functions for working with OD data, including <a href="http://riatelab.github.io/cartography/docs/reference/getLinkLayer.html"><code>getLinkLayer()</code></a>
</li>
<li>
<a href="https://pacha.dev/gravity/">gravity</a> is an R package for developing ‘gravity models’ to estimate flow between zones</li>
<li>
<a href="https://github.com/teralytics/flowmap.gl">flowmap.gl</a>, a JavaScript package for visualising OD data</li>
<li>
<a href="http://arabesque.ifsttar.fr/">Arabesque</a> is another JavaScript project for working with OD data</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/itsleeds/od/">https://​github.com/​itsleeds/​od/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/itsleeds/od/issues">https://​github.com/​itsleeds/​od/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Robin Lovelace <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-5679-6536" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/itsleeds/od"><img src="https://img.shields.io/travis/itsleeds/od/master?logo=travis&amp;style=flat-square&amp;label=Linux" alt="Travis build status"></a></li>
<li><a href="https://cran.r-project.org/package=tic"><img src="https://www.r-pkg.org/badges/version/tic" alt="CRAN status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-red.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/robinlovelace/od/actions"><img src="https://github.com/robinlovelace/od/workflows/R%20CMD%20Check%20via%20%7Btic%7D/badge.svg?branch=master" alt="R CMD Check via {tic}"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
